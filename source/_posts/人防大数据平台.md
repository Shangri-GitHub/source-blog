---
title: 人防大数据平台
date: 2017-04-24 18:06:28
tags: angular
---
##### 1.拦截器
``` javascript

angular.module('datatower.services', [])
 //  给headers设置自定义的值
 $httpProvider.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded;charset=utf-8';

    .factory('HttpInterceptor', function ($q) {
        var interceptor = {
    		'request': function(config) {
    			if(config.method=='POST'){
    				var encodedData = '_=1';
        			for(var param in config.data){
        				var value = config.data[param];
        				if(value!=undefined){
        					encodedData += "&"+param + "=" +value;
        				}
        			}
                    config.data = encodedData;
                    config.headers = config.headers||{};
                    config.headers['Content-Type'] = 'application/x-www-form-urlencoded;charset=utf-8';
    			}
                return config;
            },	
            'response': function (response) {
                // console.log(response);
                if (response.data.respCode == '000001') {
                    var d = dialog({
                        content: '无效用户'
                    });
                    d.show();
                    setTimeout(function () {
                        d.close().remove();
                    }, 2000);
                } else if (response.data.respCode == '000002') {
                    var d = dialog({
                        content: '没有数据访问权限'
                    });
                    d.show();
                    setTimeout(function () {
                        d.close().remove();
                    }, 2000);
                } else if (response.data.respCode == '000003') {
                    var d = dialog({
                        content: '数字签名不合法'
                    });
                    d.show();
                    setTimeout(function () {
                        d.close().remove();
                    }, 2000);
                } else if (response.data.respCode == '000005') {
                    var d = dialog({
                        content: '无效的参数'
                    });
                    d.show();
                    setTimeout(function () {
                        d.close().remove();
                    }, 2000);
                } else if (response.data.respCode == '000006') {
                    var d = dialog({
                        content: '接口异常'
                    });
                    d.show();
                    setTimeout(function () {
                        d.close().remove();
                    }, 2000);
                };
                return response
            },
            'responseError': function (err) {
                // console.log(err);
                if (-1 === err.status) {
                    var d = dialog({
                        content: '请检查连接网络'
                    });
                    d.show();
                    setTimeout(function () {
                        d.close().remove();
                    }, 2000);
                }
                return $q.reject(err);
            }
        };
        return interceptor;
    })
```
##### 2.匹配对应的菜单值
``` javascript
$(".navbar-nav a").each(function (idx,a) {
    var linkFuncCode = $(this).attr("func-code");
    if(linkFuncCode){
    	var isAuthed = false;
    	$(window.auth.funcs).each(function (index,funcCode) {
        	if(linkFuncCode==funcCode){
        		isAuthed = true;
        		return false;
        	}
        });
    	if(!isAuthed){
    		$(a).parent("li").css("display","none");
    	}
    }

```