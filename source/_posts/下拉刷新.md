---
title: 下拉刷新
date: 2017-04-18 19:32:37
tags:
---

``` javascript
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="bower_components/jquery/dist/jquery.min.js"></script>
    <script src="plugins/dropload-gh-pages/dist/dropload.min.js"></script>
    <link rel="stylesheet" href="plugins/dropload-gh-pages/dist/dropload.css">
    <script src="plugins/jquery.tmpl.min.js"></script>
</head>
<body>
<div class="content">
    <ul id="movieList"></ul>
</div>

<!--列表模板-->
<script id="movieTemplate" type="text/x-jquery-tmpl">
	<li>
		<b>${date}</b>
		<b>${pic}</b>
		<b>${title}</b>
	</li>
</script>
</body>

<script>
    $(function () {
        // 页数
        var page = 0;
        // 每页展示5个
        var size = 5;

        // dropload
        $('.content').dropload({
            scrollArea: window,
            loadDownFn: function (me) {
                page++;
                // 拼接HTML
                var result = '';
                $.ajax({
                    type: 'GET',
                    url: 'http://ons.me/tools/dropload/json.php?page='+page+'&size='+size,
//                    url: rootPath + '/scmgnt/op/list/all?page=' + page + '&rows=' + size,
                    dataType: 'json',
                    xhrFields: {withCredentials: true},
                    crossDomain: true,
                    success: function (data) {
                        console.log(data);
                        var arrLen = data.length;
                        if (arrLen > 0) {

                        } else {
                            // 锁定
                            me.lock();
                            // 无数据
                            me.noData();
                        }
                        // 为了测试，延迟1秒加载
                        setTimeout(function () {
                            // 插入数据到页面，放到最后面
                            $("#movieTemplate").tmpl(data).appendTo("#movieList");

//                            $('.lists').append(result);
                            // 每次数据插入，必须重置
                            me.resetload();
                        }, 1000);
                    },
                    error: function (xhr, type) {
                        alert('Ajax error!');
                        // 即使加载出错，也得重置
                        me.resetload();
                    }
                });
            }
        });
    });
</script>
</html>
```